@{
    ViewData["Title"] = "Th√™m s·∫£n ph·∫©m";
    var cats = ViewBag.Categories as List<(int Id, string Name)>;
}
<br />
<link rel="stylesheet" href="~/css/admin-product-create.css" />
<div class="container-product">
    <h2>Th√™m s·∫£n ph·∫©m m·ªõi</h2>

    <form asp-action="Create" method="post" enctype="multipart/form-data">
        <div class="form-group">
            <label>T√™n s·∫£n ph·∫©m</label>
            <input type="text" name="ProductName" required />
        </div>

        <div class="row">
            <div class="form-group">
                <label>Danh m·ª•c</label>
                <select name="CategoryID">
                    <option value="">-- Ch·ªçn danh m·ª•c --</option>
                    <option value="1">ƒêi·ªán tho·∫°i</option>
                    <option value="2">M√†n h√¨nh</option>
                </select>
            </div>
            <!-- Popup th√™m danh m·ª•c -->
            <div id="addCategoryModal"
                 style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
            background:rgba(0,0,0,0.4); z-index:9999; justify-content:center; align-items:center;">
                <div style="background:#fff; padding:20px; border-radius:10px; width:350px;">
                    <h4>Th√™m danh m·ª•c m·ªõi</h4>
                    <div class="form-group">
                        <label>T√™n danh m·ª•c</label>
                        <input id="newCategoryName" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label>M√¥ t·∫£ (tu·ª≥ ch·ªçn)</label>
                        <textarea id="newCategoryDescription" class="form-control"></textarea>
                    </div>
                    <div class="d-flex justify-content-end gap-2 mt-3">
                        <button type="button" class="btn btn-secondary" onclick="closeAddCategory()">H·ªßy</button>
                        <button type="button" class="btn btn-primary" onclick="addCategory()">L∆∞u</button>
                    </div>
                </div>
            </div>
            <script>
                function showAddCategory() {
                    document.getElementById('addCategoryModal').style.display = 'block';
                }

                function closeAddCategory() {
                    document.getElementById('addCategoryModal').style.display = 'none';
                }

                async function addCategory() {
                    const name = document.getElementById('newCategoryName').value.trim();
                    if (!name) return alert("Vui l√≤ng nh·∫≠p t√™n danh m·ª•c!");

                    const res = await fetch('/Admin/Category/AddAjax', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ TenDanhMuc: name })
                    });

                    if (res.ok) {
                        alert("ƒê√£ th√™m danh m·ª•c m·ªõi!");
                        location.reload();
                    } else {
                        alert("L·ªói khi th√™m danh m·ª•c!");
                    }
                }
            </script>


            <div class="form-group">
                <label>Gi√°</label>
                <input type="number" name="Price" />
            </div>

            <div class="form-group">
                <label>Gi√° khuy·∫øn m√£i</label>
                <input type="number" name="PriceSale" />
            </div>
        </div>

        <div class="form-group">
            <label>M√¥ t·∫£ ng·∫Øn</label>
            <textarea name="ShortDescription"></textarea>
        </div>

        <div class="form-group">
            <label>·∫¢nh s·∫£n ph·∫©m</label>
            <div class="image-upload" id="upload-box">
                <p>üì∏ Nh·∫•p ƒë·ªÉ ch·ªçn ho·∫∑c k√©o th·∫£ nhi·ªÅu ·∫£nh v√†o ƒë√¢y</p>
                <input type="file" name="Images" id="image-input" multiple hidden />
            </div>
            <div class="image-preview" id="preview"></div>
        </div>

        <button type="submit" class="btn btn-primary">Th√™m s·∫£n ph·∫©m</button>
        <a asp-action="Index" class="btn btn-secondary">H·ªßy</a>
    </form>
</div>

<script>
    const uploadBox = document.getElementById("upload-box");
    const input = document.getElementById("image-input");
    const preview = document.getElementById("preview");

    uploadBox.addEventListener("click", () => input.click());
    input.addEventListener("change", () => {
        preview.innerHTML = "";
        for (const file of input.files) {
            const img = document.createElement("img");
            img.src = URL.createObjectURL(file);
            preview.appendChild(img);
        }
    });
</script>


