@{
    ViewData["Title"] = "Th√™m s·∫£n ph·∫©m";
}

<link rel="stylesheet" href="~/css/admin-product-create.css" />

<div class="container-product">
    <h2>Th√™m s·∫£n ph·∫©m m·ªõi</h2>

    <form asp-action="Create" method="post" enctype="multipart/form-data">
        @Html.AntiForgeryToken()

        <!-- T√™n s·∫£n ph·∫©m -->
        <div class="form-group">
            <label>T√™n s·∫£n ph·∫©m</label>
            <input type="text" name="ProductName" required class="form-control" />
        </div>

        <!-- Danh m·ª•c -->
        <div class="form-group">
            <label>Danh m·ª•c</label>
            <select name="CategoryId" class="form-select">
                <option value="">-- Ch·ªçn danh m·ª•c --</option>
                @if (ViewBag.Categories != null)
                {
                    foreach (var cat in ViewBag.Categories)
                    {
                        <option value="@cat.CategoryId">@cat.CategoryName</option>
                    }
                }
            </select>
        </div>

        <div class="form-group">
            <label>Ho·∫∑c nh·∫≠p danh m·ª•c m·ªõi (n·∫øu ch∆∞a c√≥)</label>
            <input type="text" name="NewCategoryName" class="form-control" placeholder="T√™n danh m·ª•c m·ªõi" />
        </div>


        <!-- Gi√° -->
        <div class="form-group">
            <label>Gi√°</label>
            <input type="number" name="Price" class="form-control" />
        </div>

        <!-- Gi√° khuy·∫øn m√£i -->
        <div class="form-group">
            <label>Gi√° khuy·∫øn m√£i</label>
            <input type="number" name="PriceSale" class="form-control" />
        </div>

        <!-- M√¥ t·∫£ ng·∫Øn -->
        <div class="form-group">
            <label>M√¥ t·∫£ ng·∫Øn</label>
            <textarea name="ShortDescription" class="form-control"></textarea>
        </div>

        <!-- ·∫¢nh -->
        <div class="form-group">
            <label>·∫¢nh s·∫£n ph·∫©m</label>
            <div class="image-upload" id="upload-box">
                <p>üì∏ Nh·∫•p ƒë·ªÉ ch·ªçn ho·∫∑c k√©o th·∫£ nhi·ªÅu ·∫£nh v√†o ƒë√¢y</p>
                <input type="file" name="Images" id="image-input" multiple hidden />
            </div>
            <div class="image-preview" id="preview"></div>
        </div>

        <!-- Submit -->
        <button type="submit" class="btn btn-primary">Th√™m s·∫£n ph·∫©m</button>
        <a asp-action="Index" class="btn btn-secondary">H·ªßy</a>
    </form>
</div>

<!-- Popup th√™m danh m·ª•c -->
<div id="addCategoryModal"
     style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
background:rgba(0,0,0,0.4); z-index:9999; display:flex; justify-content:center; align-items:center;">
    <div style="background:#fff; padding:20px; border-radius:10px; width:350px;">
        <h4>Th√™m danh m·ª•c m·ªõi</h4>
        <div class="form-group">
            <label>T√™n danh m·ª•c m·ªõi</label>
            <input type="text" id="newCategoryName" class="form-control" placeholder="T√™n danh m·ª•c m·ªõi (n·∫øu c√≥)" />
        </div>
        <div class="form-group">
            <label>M√¥ t·∫£ (tu·ª≥ ch·ªçn)</label>
            <textarea id="newCategoryDescription" class="form-control"></textarea>
        </div>
        <div class="d-flex justify-content-end gap-2 mt-3">
            <button type="button" class="btn btn-secondary" onclick="closeAddCategory()">H·ªßy</button>
            <button type="button" class="btn btn-primary" onclick="addCategory()">L∆∞u</button>
        </div>
    </div>
</div>

<!-- Script -->
<script>
    // ====== X·ª≠ l√Ω popup danh m·ª•c ======
    function showAddCategory() {
        document.getElementById('addCategoryModal').style.display = 'flex';
    }

    function closeAddCategory() {
        document.getElementById('addCategoryModal').style.display = 'none';
    }

    function addCategory() {
        const name = document.getElementById('newCategoryName').value.trim();
        if (!name) {
            alert("Vui l√≤ng nh·∫≠p t√™n danh m·ª•c m·ªõi!");
            return;
        }

        // Th√™m v√†o danh s√°ch select
        const select = document.querySelector("select[name='CategoryId']");
        const option = document.createElement("option");
        option.text = name;
        option.value = "new:" + name; // ƒë√°nh d·∫•u l√† danh m·ª•c m·ªõi
        option.selected = true;
        select.add(option);

        // ·∫®n popup
        closeAddCategory();
    }

    // ====== X·ª≠ l√Ω ·∫£nh preview ======
    const uploadBox = document.getElementById("upload-box");
    const input = document.getElementById("image-input");
    const preview = document.getElementById("preview");

    uploadBox.addEventListener("click", () => input.click());
    input.addEventListener("change", () => {
        preview.innerHTML = "";
        for (const file of input.files) {
            const img = document.createElement("img");
            img.src = URL.createObjectURL(file);
            img.style.width = "100px";
            img.style.margin = "5px";
            img.style.borderRadius = "8px";
            preview.appendChild(img);
        }
    });
</script>
